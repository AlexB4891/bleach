% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/resumen.R
\name{cubo}
\alias{cubo}
\title{Cubo de agregaciones (power set de grupos) para variables numéricas}
\usage{
cubo(tabla, grupo, agregacion, peso = NULL)
}
\arguments{
\item{tabla}{Un \code{data.frame}/\code{tibble} con las columnas de agrupación (\code{grupo}),
variables numéricas a agregar (\code{agregacion}) y opcionalmente \code{peso}.}

\item{grupo}{Character vector con los nombres de columnas de agrupación base.}

\item{agregacion}{Character vector con los nombres de columnas numéricas a agregar.}

\item{peso}{\code{NULL} (default) o \code{character(1)} con el nombre de la columna de pesos.
Si se especifica, solo se aplica en el primer nivel de cálculo (el más granular);
los niveles siguientes se obtienen por re-agregación de sumas ya ponderadas.}
}
\value{
Un \code{tibble} con las sumas por cada subconjunto del conjunto potencia de \code{grupo}.
La salida es "larga" en el sentido de que contiene filas de distintos niveles de
agregación; las columnas de grupo presentes dependerán del subconjunto (las que
no aplican no existen/son omitidas en ese bloque). El resultado final se obtiene
con \code{list_rbind(lista_resumen)}.
}
\description{
Construye un "cubo" de resúmenes generando agregaciones para todas las
combinaciones posibles de variables de agrupación (\code{grupo}), usando el conjunto
potencia. Para cada subconjunto de \code{grupo}, calcula sumas (o sumas ponderadas si
\code{peso} se especifica) sobre \code{agregacion}, y devuelve la unión (row-bind) de todos
los niveles de agregación en una sola tabla larga.
}
\details{
La función optimiza el cálculo reutilizando resultados: en lugar de resumir desde
\code{tabla} para cada subconjunto, resume desde el resultado previo "más granular"
cuando es posible.
}
\section{Dependencias}{

\itemize{
\item Requiere \code{rje::powerSet()} para generar el conjunto potencia de \code{grupo}.
\item Requiere \code{list_rbind()} (por ejemplo, \code{purrr::list_rbind}) para concatenar resultados.
}
}

\examples{
library(dplyr)
df <- tibble::tibble(
  prov = c("A","A","B","B"),
  cant = c("X","Y","X","Y"),
  sexo = c("M","F","M","F"),
  valor = c(1,2,3,4),
  w = c(1,1,2,2)
)

# Cubo sin ponderación sobre 'valor'
cubo(df, grupo = c("prov","cant","sexo"), agregacion = c("valor"))

# Cubo ponderado (primer nivel): sum(valor*w)
cubo(df, grupo = c("prov","cant","sexo"), agregacion = c("valor"), peso = "w")

}
